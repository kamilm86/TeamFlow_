WITH LatestEntries AS (
    -- Krok 1: Znajdź najnowszy wpis dla każdego wniosku (tak jak w Sparku)
    SELECT
        numer_wniosku,
        data_modyfikacji,
        value,
        ROW_NUMBER() OVER (PARTITION BY numer_wniosku ORDER BY data_modyfikacji DESC) as rn
    FROM
        twoja_baza.twoj_widok
)
-- Krok 2: Z najnowszych wpisów (gdzie rn=1) wyciągnij wartości dla kluczy JSON
SELECT
    numer_wniosku,
    data_modyfikacji,
    get_json_object(value, '$.status') AS status_wniosku,
    get_json_object(value, '$.doradca') AS doradca,
    get_json_object(value, '$.placowka') AS placowka,
    get_json_object(value, '$.dane_dodatkowe.typ_produktu') AS typ_produktu
FROM
    LatestEntries
WHERE
    rn = 1;
